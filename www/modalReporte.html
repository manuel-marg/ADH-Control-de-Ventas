
<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
    <style>
      body { font-family: Arial, sans-serif; }
      .container { padding: 20px; }
      h2, h3 { color: #4285f4; }
      .kpi-container { display: flex; justify-content: space-around; background-color: #f2f2f2; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
      .kpi { text-align: center; }
      .kpi .value { font-size: 1.5em; font-weight: bold; }
      .kpi .label { font-size: 0.9em; color: #666; }
      .tab-container { display: flex; border-bottom: 1px solid #ccc; margin-bottom: 15px; }
      .tab { padding: 10px 15px; cursor: pointer; }
      .tab.active { border-bottom: 3px solid #4285f4; font-weight: bold; }
      .tab-content { display: none; }
      .tab-content.active { display: block; }
      table { width: 100%; border-collapse: collapse; margin-top: 15px; }
      th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
      th { background-color: #f2f2f2; }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Reporte de Ventas</h2>
      <p><strong>Período:</strong> <?= fechas.inicio_str ?> - <?= fechas.fin_str ?></p>

      <div class="kpi-container">
        <div class="kpi">
          <div class="value">$<?= kpis.totalUSD.toFixed(2) ?></div>
          <div class="label">Ingresos Totales (USD)</div>
        </div>
        <div class="kpi">
          <div class="value"><?= kpis.numVentas ?></div>
          <div class="label">Nº de Ventas</div>
        </div>
        <div class="kpi">
          <div class="value"><?= kpis.numCortesias ?></div>
          <div class="label">Nº de Cortesías</div>
        </div>
        <div class="kpi">
          <div class="value"><?= kpis.numPendientes ?></div>
          <div class="label">Nº de Pendientes</div>
        </div>
      </div>

      <div class="tab-container">
        <div class="tab active" onclick="openTab(event, 'resumen')">Resumen de Ventas</div>
        <div class="tab" onclick="openTab(event, 'categorias')">Por Categoría</div>
        <div class="tab" onclick="openTab(event, 'pagos')">Por Método de Pago</div>
        <div class="tab" onclick="openTab(event, 'otros')">Cortesías y Pendientes</div>
      </div>

      <div id="resumen" class="tab-content active">
        <h3>Resumen de Ventas</h3>
        <table>
          <tr>
            <th>Fecha</th>
            <th>Usuario</th>
            <th>Productos</th>
            <th>Total USD</th>
            <th>Total BS</th>
          </tr>
          <? for (var i = 0; i < ventas.length; i++) { ?>
            <tr>
              <td><?= ventas[i][0] ?></td>
              <td><?= ventas[i][1] ?></td>
              <td><?= ventas[i][2] ?></td>
              <td>$<?= parseFloat(ventas[i][3] || 0).toFixed(2) ?></td>
              <td>Bs. <?= parseFloat(ventas[i][4] || 0).toFixed(2) ?></td>
            </tr>
          <? } ?>
        </table>
      </div>

      <div id="categorias" class="tab-content">
        <h3>Ventas por Categoría</h3>
        <table>
          <tr>
            <th>Categoría</th>
            <th>Nº de Ventas</th>
            <th>Ingresos (USD)</th>
          </tr>
          <? for (var cat in porCategoria) { ?>
            <tr>
              <td><?= cat ?></td>
              <td><?= porCategoria[cat].count ?></td>
              <td>$<?= porCategoria[cat].total.toFixed(2) ?></td>
            </tr>
          <? } ?>
        </table>
      </div>

      <div id="pagos" class="tab-content">
        <h3>Ventas por Método de Pago</h3>
        <table>
          <tr>
            <th>Método de Pago</th>
            <th>Nº de Transacciones</th>
            <th>Total Recaudado</th>
          </tr>
           <? for (var met in porMetodoPago) { ?>
            <tr>
              <td><?= met ?></td>
              <td><?= porMetodoPago[met].count ?></td>
              <td>$<?= porMetodoPago[met].total.toFixed(2) ?></td>
            </tr>
          <? } ?>
        </table>
      </div>

      <div id="otros" class="tab-content">
        <h3>Cortesías</h3>
        <? if (cortesias.length > 0) { ?>
          <table>
            <tr><th>Fecha</th><th>Usuario</th><th>Productos</th></tr>
            <? for (var i = 0; i < cortesias.length; i++) { ?>
              <tr>
                <td><?= cortesias[i][0] ?></td>
                <td><?= cortesias[i][1] ?></td>
                <td><?= cortesias[i][2] ?></td>
              </tr>
            <? } ?>
          </table>
        <? } else { ?>
          <p>No hay ventas de cortesía en este período.</p>
        <? } ?>

        <h3>Pendientes</h3>
        <? if (pendientes.length > 0) { ?>
          <table>
            <tr><th>Fecha</th><th>Cliente</th><th>Productos</th><th>Total USD</th></tr>
            <? for (var i = 0; i < pendientes.length; i++) { ?>
              <tr>
                <td><?= pendientes[i][0] ?></td>
                <td><?= pendientes[i][1] ?></td>
                <td><?= pendientes[i][2] ?></td>
                <td>$<?= parseFloat(pendientes[i][3] || 0).toFixed(2) ?></td>
              </tr>
            <? } ?>
          </table>
        <? } else { ?>
          <p>No hay ventas pendientes en este período.</p>
        <? } ?>
      </div>

    </div>
    <script>
      function openTab(evt, tabName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) {
          tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tab");
        for (i = 0; i < tablinks.length; i++) {
          tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.className += " active";
      }
    </script>
  </body>
</html>
